<!DOCTYPE html>
<html>
<script src="static/aws-cognito-sdk.min.js"></script>
<script src="static/amazon-cognito-auth.min.js"></script>
<script type="text/javascript" src="static/appconfig.js"></script>

  <script>
    /* eslint-disable prefer-template */

    const CognitoAuth = AmazonCognitoIdentity.CognitoAuth;

    const poolid = appIdentityPoolId;
    const region = appRegion;
    localStorage.setItem('poolid', poolid);
    localStorage.setItem('awsregionname', region);
    const token = localStorage.getItem('idtokenjwt');
    const rd1 = window.location.protocol + '//' + window.location.hostname + ':' + window.location.port + '/loggedin';
    const rd2 = window.location.protocol + '//' + window.location.hostname + ':' + window.location.port + '/loggedout';
    console.log(rd1);
    console.log(rd2);
    const authData = {
      ClientId: appUserPoolClientId, // Your client id here
      AppWebDomain: appDomainName,
      TokenScopesArray: ['email', 'openid', 'profile'],
      RedirectUriSignIn: rd1,
      RedirectUriSignOut: rd2,
    };

    /* eslint-disable prefer-template, object-shorthand */

    const auth = new CognitoAuth(authData);

    function logout() {
      console.log('do logout');
      localStorage.removeItem('idtokenjwt');
      auth.signOut();
    }

    auth.userhandler = {
      onSuccess: function (result) {
        console.log('Sign in success: ' + JSON.stringify(result, null, 2));
      },
      onFailure: function (err) {
        console.log('Sign in failure: ' + JSON.stringify(err, null, 2));
      },
    };

    const curUrl = window.location.href;
    if (curUrl.indexOf('/home') >= 0) {
      if (token === null || token === undefined) {
        auth.getSession();
      } else {
        console.log('goto home');
      }
    } else if (curUrl.indexOf('loggedin') >= 0) {
      auth.parseCognitoWebResponse(curUrl);
      const idToken = auth.getSignInUserSession().getIdToken();
      localStorage.setItem('idtokenjwt', idToken.getJwtToken());
      window.location.href = '/home';
    } else if (curUrl.indexOf('loggedout') >= 0) {
      console.log('logout complete');
      window.location.href = '/home';
    } else if (curUrl.indexOf('/dosignout') >= 0) {
      logout();
    } else {
      auth.getSession();
    }


  </script>
  <head>
    <meta charset="utf-8">
    <title>dashboard-app</title>
  </head>
  <body>
    <div id="app"></div>
    <!-- built files will be auto injected -->
    <!-- add CSS link inside the HEAD tag -->
    <!-- add script tag towards the bottom of the html body section -->
  </body>
</html>
